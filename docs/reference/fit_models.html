<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Fit a stan model to multiple datasets — fit_models • rstansim</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>
  
  
<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">rstansim</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="..//index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/managing-results.html">Managing simulation results with rstansim</a>
    </li>
    <li>
      <a href="../articles/model-fitting.html">Model fitting and capture of relevant data</a>
    </li>
    <li>
      <a href="../articles/reproducability.html">A Note on Reproducability</a>
    </li>
    <li>
      <a href="../articles/simulating_data.html">Simulating data using rstansim</a>
    </li>
    <li>
      <a href="../articles/using-rstansim.html">Using rstansim to run a simulation study</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/Ewan-Keith/rstansim#rstansim">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fit a stan model to multiple datasets</h1>
    </div>

    
    <p><code>fit_models()</code> fits a stan model across multiple datasets,
  collates, and returns summary information and data for all fitted models as
  a <code>stansim_simulation</code> object. All fitted models have basic
  reproducability information recorded; such as parameter inits and seeds,
  along with parameter estimates, and simulation information such as time and
  date ran.</p>
<p>Raw stan posterior samples are not returned, rather the user specifies the
  estimates they wish to record (e.g. posterior percentiles, Rhat, etc.) and
  the parameters for which they wish to record these estimates. All data is
  collated into a single, <a href='http://tidyverse.org/'>tidy</a> dataframe for
  further analysis.</p>
<p>By default the function caches completed runs as it progresses, so that
  progress is not lost in the case of function failure. By simply running the
  function with the same calls in the same working directory it will pick up
  where it left off. When the function terminates as expected this cache is
  removed.</p>
    

    <pre class="usage"><span class='fu'>fit_models</span>(<span class='kw'>sim_name</span> <span class='kw'>=</span> <span class='fu'>paste0</span>(<span class='st'>"Stansim_"</span>, <span class='fu'>Sys.time</span>()), <span class='kw'>sim_data</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>stan_args</span> <span class='kw'>=</span> <span class='fu'>list</span>(), <span class='kw'>calc_loo</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>use_cores</span> <span class='kw'>=</span> <span class='fl'>1L</span>,
  <span class='kw'>parameters</span> <span class='kw'>=</span> <span class='st'>"all"</span>, <span class='kw'>probs</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='fl'>0.025</span>, <span class='fl'>0.25</span>, <span class='fl'>0.5</span>, <span class='fl'>0.75</span>, <span class='fl'>0.975</span>),
  <span class='kw'>estimates</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"mean"</span>, <span class='st'>"se_mean"</span>, <span class='st'>"sd"</span>, <span class='st'>"n_eff"</span>, <span class='st'>"Rhat"</span>),
  <span class='kw'>stan_warnings</span> <span class='kw'>=</span> <span class='st'>"catch"</span>, <span class='kw'>cache</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>seed</span> <span class='kw'>=</span> <span class='fu'>floor</span>(<span class='kw pkg'>stats</span><span class='kw ns'>::</span><span class='fu'><a href='http://www.rdocumentation.org/packages/stats/topics/Uniform'>runif</a></span>(<span class='fl'>1</span>, <span class='fl'>1</span>,
  <span class='fl'>1e+05</span>)))</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>sim_name</th>
      <td><p>A name attached to the <code>stansim_simulation</code> object to
help identify it. It is strongly recomended that an informative name is
assigned, especially if <code>stansim_simulation</code> objects are to be
combined in to a <code>stansim_collection</code> object for management of
results.</p></td>
    </tr>
    <tr>
      <th>sim_data</th>
      <td><p>Either an object of class <code>stansim_data</code> or a vector of
strings pointing to the location of .rds files containing the simulation
data. See the vignette on producing simulation data for details on the
formatting of these datasets.</p></td>
    </tr>
    <tr>
      <th>stan_args</th>
      <td><p>A list of function arguments to be used by the internal
<code><a href='http://www.rdocumentation.org/packages/rstan/topics/stanmodel-method-sampling'>rstan::sampling()</a></code> function when fitting the models. If not specified
then the <code><a href='http://www.rdocumentation.org/packages/rstan/topics/stanmodel-method-sampling'>rstan::sampling()</a></code> function defaults are used.</p></td>
    </tr>
    <tr>
      <th>calc_loo</th>
      <td><p>If <code>TRUE</code> then model fit statisics will be calculated
using the <code>loo</code> package. If <code>TRUE</code> there must be a valid log_lik
quantity specified in the generated quantities section of the provided stan
model.</p></td>
    </tr>
    <tr>
      <th>use_cores</th>
      <td><p>Number of cores to use when running in parallel. Each stan
model is fitted serially regardless of the number of chains ran, as
parallelisation across models is more flexible than within.</p></td>
    </tr>
    <tr>
      <th>parameters</th>
      <td><p>A character vector indicating which parameters should have
estimates returned and stored from the fitted models. By default all
parameters are returned, for non-scalar parameters you cannot select
subsets of the parameter (e.g. must request <code>theta</code> rather than
<code>theta[1]</code>).</p></td>
    </tr>
    <tr>
      <th>probs</th>
      <td><p>A numeric vector of values between 0 and 1. Corresponding
quantiles will be estimated and returned for all fitted models.</p></td>
    </tr>
    <tr>
      <th>estimates</th>
      <td><p>A character vector of non-quantile estimates to be returned
for each model parameter. Argument must be some subset of the default
character vector.</p></td>
    </tr>
    <tr>
      <th>stan_warnings</th>
      <td><p>How warnings returned by individual <code>stan</code>
instances should be handled. <code>"catch"</code> records all warnings in the
returned object alongside other instance level data, <code>"print"</code> simply
prints warnings to the console as the models are fit (default <code>stan</code>
behaviour), and <code>"suppress"</code> suppressess all warnings without
recording them.</p></td>
    </tr>
    <tr>
      <th>cache</th>
      <td><p>If <code>TRUE</code> then the results for each instance are written to
a local, temporary file so that data is not lost should the function not
terminate properly. This temporary data is removed upon the model
terminating as expected. If <code>FALSE</code> no data is written and results are
only returned upon the correct termination of the whole function. The
default value of <code>TRUE</code> is recommended unless there are relevant
write-permission restrictions.</p></td>
    </tr>
    <tr>
      <th>seed</th>
      <td><p>Set a seed for the function.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An S3 object of class <code>stansim_simulation</code> recording relevant
  simulation data.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><span class='co'># NOT RUN {</span>
<span class='co'># specify arguments for stan</span>
<span class='no'>StanArgs</span> <span class='kw'>&lt;-</span> <span class='fu'>list</span>(<span class='kw'>file</span> <span class='kw'>=</span> <span class='st'>'8schools.stan'</span>,
                 <span class='kw'>iter</span> <span class='kw'>=</span> <span class='fl'>1000</span>, <span class='kw'>chains</span> <span class='kw'>=</span> <span class='fl'>4</span>)

<span class='co'># get number of cores</span>
<span class='no'>core_num</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>parallel</span><span class='kw ns'>::</span><span class='fu'><a href='http://www.rdocumentation.org/packages/parallel/topics/detectCores'>detectCores</a></span>()

<span class='co'># get the list of data file locations</span>
<span class='no'>datasets</span> <span class='kw'>&lt;-</span> <span class='fu'>dir</span>(<span class='st'>"data/repo"</span>, <span class='kw'>full.names</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)

<span class='co'># fit the model to all datasets using specified stan arguments</span>
<span class='co'># store the specified estimates for all parameters</span>
<span class='no'>simulation</span> <span class='kw'>&lt;-</span> <span class='fu'>fit_models</span>(
  <span class='kw'>sim_name</span> <span class='kw'>=</span> <span class='st'>"stansim simulation"</span>,
  <span class='kw'>sim_data</span> <span class='kw'>=</span> <span class='no'>datasets</span>,
  <span class='kw'>stan_args</span> <span class='kw'>=</span> <span class='no'>StanArgs</span>,
  <span class='kw'>calc_loo</span> <span class='kw'>=</span> <span class='no'>T</span>,
  <span class='kw'>use_cores</span> <span class='kw'>=</span> <span class='no'>core_num</span>,
  <span class='kw'>probs</span> <span class='kw'>=</span>  <span class='fu'>c</span>(<span class='fl'>.025</span>, <span class='fl'>.5</span>, <span class='fl'>.975</span>),
  <span class='kw'>estimates</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"mean"</span>, <span class='st'>"n_eff"</span>, <span class='st'>"Rhat"</span>)
)
<span class='co'># }</span><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Ewan Keith.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
