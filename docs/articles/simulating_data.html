<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simulating data using rstansim • rstansim</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">rstansim</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="..//index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/managing-results.html">Managing simulation results with rstansim</a>
    </li>
    <li>
      <a href="../articles/model-fitting.html">Model fitting and capture of relevant data</a>
    </li>
    <li>
      <a href="../articles/reproducability.html">A Note on Reproducability</a>
    </li>
    <li>
      <a href="../articles/simulating_data.html">Simulating data using rstansim</a>
    </li>
    <li>
      <a href="../articles/using-rstansim.html">Using rstansim to run a simulation study</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Ewan-Keith/rstansim#rstansim">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Simulating data using rstansim</h1>
                        <h4 class="author">Ewan Keith</h4>
            
            <h4 class="date">2017-09-03</h4>
          </div>

    
    
<div class="contents">
<p>The flexibility of the stan modelling language makes it an attractive option for simulating data, whether to be used in a simulation study or for other uses. In order to use data simulated from stan as input to a stan model it needs to be reshaped and properly configured, the rstansim function <code><a href="../reference/simulate_data.html">simulate_data()</a></code> is designed to make this process as simple as possibe.</p>
<div id="the-simulate_data-function" class="section level2">
<h2 class="hasAnchor">
<a href="#the-simulate_data-function" class="anchor"></a>The simulate_data() function</h2>
<p>The <code><a href="../reference/simulate_data.html">simulate_data()</a></code> function takes a stan model and a set of further arguments and generates datasets according to the stan model, in a format where they are ready to be fed back in as input data for another stan model. By default the function has two effects; firstly it saves the simulated datasets as .rds files in a specified directory, and secondly it returns an object with S3 class <code>stansim_data</code>. This object stores summary information on the simulated datasets and can be fed directly to the <code><a href="../reference/fit_models.html">fit_models()</a></code> function to fit a stan model to all datasets.</p>
</div>
<div id="arguments" class="section level2">
<h2 class="hasAnchor">
<a href="#arguments" class="anchor"></a>Arguments</h2>
<div id="file" class="section level3">
<h3 class="hasAnchor">
<a href="#file" class="anchor"></a>file</h3>
<p>The main argument is the stan model from which data is to be simulated. This can be specified either as an object in R, or by specifying a file location ending in “.stan”. Any valid stan model is acceptable for this argument, but there are a few factors to consider in specifying it:</p>
<ol style="list-style-type: decimal">
<li>Any object in the data, transformed data, parameters, transformed parameters, model, or generated quantities blocks can be returned by the function.</li>
<li>Input values must be provided for any data arguments. Even if the data values are not relevant to the data you wish to extract, the model will not run if valid inputs are not provided for all data arguments.</li>
<li>By deafult, any object in the stan code with a name begining with “sim_”, will have this removed from their name when returned, so “sim_x” would be returned as “x”. This can be useful if you wish to feed the simulated data back in to the same model, to prevent name clashes between the input and simulated output variables.</li>
<li>The stan model specifies how values should be estimated for a single dataset, the number of datasets to return is managed by the <code>nsim</code> argument. So when specifying the stan model only consider how you wish a single dataset to look.</li>
<li>At least one model parameter must be specified in the stan code or the model will fail to sample.</li>
</ol>
</div>
<div id="data_name" class="section level3">
<h3 class="hasAnchor">
<a href="#data_name" class="anchor"></a>data_name</h3>
<p>This is a descriptive name to help identify the simulated data. It will be used as the stem_name for simulated datasets (e.g. <code>data_name = "correlated multi-regression"</code> would be saved as <code>uncorrelated multi-regression_1.rds</code>) which will in turn be saved into any simulation objects, so it is highly recomended that an informative value is set. If none is provided it will simply deafult to the sys.time when ran.</p>
</div>
<div id="input_data" class="section level3">
<h3 class="hasAnchor">
<a href="#input_data" class="anchor"></a>input_data</h3>
<p>As stated above, any data arguments in the stan model need to have valid values sepecified for them, whether or not they are relevant to the data to be simulated. These should be provided in the typical <code>rstan</code> form, as a named list.</p>
</div>
<div id="param_values" class="section level3">
<h3 class="hasAnchor">
<a href="#param_values" class="anchor"></a>param_values</h3>
<p>A named list as with <code>input_data</code>, this specifies the values of all fixed parameters in the simulation model. If any parameters aren’t specified here there value will be randomly assigned, as this is rarely likely to be a desired behaviour it is recommended that all parameters have their values specified through this argument.</p>
</div>
<div id="nsim" class="section level3">
<h3 class="hasAnchor">
<a href="#nsim" class="anchor"></a>nsim</h3>
<p>The number of datasets to simulate.</p>
</div>
<div id="other-arguments" class="section level3">
<h3 class="hasAnchor">
<a href="#other-arguments" class="anchor"></a>Other arguments</h3>
<p>The main arguments for the function are covered above, further detail can be found in the <code><a href="../reference/simulate_data.html">simulate_data()</a></code> function documentation.</p>
</div>
</div>
<div id="simple-example" class="section level2">
<h2 class="hasAnchor">
<a href="#simple-example" class="anchor"></a>Simple example</h2>
<p>Below is a very simple example, simulating 10 datasets with 2 perfectly correlated variables, x and y, where y is double of x. First off, the stan model is defined.</p>
<pre class="stan"><code>// saved as basic_sim.stan
parameters {
  real scale;
}
generated quantities {
  vector[100] x; 
  vector[100] y; 

  for(i in 1:100) x[i] = normal_rng(100, 15);
  for(i in 1:100) y[i] = scale * x[i];
}</code></pre>
<p>This file is then fed to the <code><a href="../reference/simulate_data.html">simulate_data()</a></code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rstansim)

small_simulation &lt;-<span class="st"> </span><span class="kw"><a href="../reference/simulate_data.html">simulate_data</a></span>(
  <span class="dt">file =</span> <span class="st">"basic_sim.stan"</span>, 
  <span class="dt">param_values =</span> <span class="kw">list</span>(<span class="st">"scale"</span> =<span class="st"> </span><span class="dv">2</span>),
  <span class="dt">vars =</span> <span class="kw">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>),
  <span class="dt">data_name =</span> <span class="st">"small_sim_example"</span>,
  <span class="dt">nsim =</span> <span class="dv">10</span>,
  <span class="dt">path =</span> <span class="st">"sim_data/"</span>
  )</code></pre></div>
<p>We can check the data now.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># is the data saved?</span>
<span class="kw">dir</span>(<span class="st">"sim_data"</span>)
##  [1] "small_sim_example_10.rds" "small_sim_example_1.rds" 
##  [3] "small_sim_example_2.rds"  "small_sim_example_3.rds" 
##  [5] "small_sim_example_4.rds"  "small_sim_example_5.rds" 
##  [7] "small_sim_example_6.rds"  "small_sim_example_7.rds" 
##  [9] "small_sim_example_8.rds"  "small_sim_example_9.rds"

<span class="co"># is the data of the correct format?</span>
example_data &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">"sim_data/small_sim_example_1.rds"</span>)
<span class="kw">str</span>(example_data)
## List of 2
##  $ x: num [1:100(1d)] 101 89.7 66.5 86 78 ...
##  $ y: num [1:100(1d)] 202 179 133 172 156 ...

<span class="kw">library</span>(ggplot2)
<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(<span class="kw">as.data.frame</span>(example_data), <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_point">geom_point</a></span>()</code></pre></div>
<p><img src="simulating_data_files/figure-html/unnamed-chunk-4-1.png" width="672"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#the-simulate_data-function">The simulate_data() function</a></li>
      <li><a href="#arguments">Arguments</a></li>
      <li><a href="#simple-example">Simple example</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Ewan Keith.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
